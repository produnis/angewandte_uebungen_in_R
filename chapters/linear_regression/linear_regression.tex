% Author: Alfredo Sánchez Alberca (asalber@ceu.es)

\chapter{Linear regression}\label{cha:linear-regression}

\section{Solved exercises}
\begin{enumerate}[leftmargin=*]
\item The values of two variables $X$ and $Y$ measured in a sample of 10 individuals are:
\[
\begin{array}{lrrrrrrrrrr}
\hline
X & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 \\
Y & 2 & 5 & 8 & 11 & 14 & 17 & 20 & 23 & 26 & 29\\
\hline
\end{array}
\]

Do the following operations:

\begin{enumerate}
\item Create a data set with the variables \variable{X} and \variable{Y} and enter the data.
\item Construct the scatter plot of \variable{X} and \variable{Y}.
\begin{indication}
\begin{enumerate}
\item Select the menu \menu{Teaching > Charts > Scatter plot}.
\item In the dialog displayed, select the variable \variable{Y} in the field \field{Y variable}, and the variable
\variable{X} in the field \field{X variable}, and click the button \button{Submit}.
\end{enumerate}
\end{indication}

According to the point cloud, what type of regression model explains better the relation between \variable{X} and
\variable{Y}?

\item Compute the regression line of $Y$ on $X$.
\begin{indication}
\begin{enumerate}
\item Select the menu \menu{Teaching > Regression > Linear regression}.
\item In the dialog displayed, insert the variable \variable{Y} in the field \field{Dependent variable} and the variable
\variable{X} in the field \field{Independent variable(s)}, and click the button \button{Submit}.
\end{enumerate}
\end{indication}

\item Plot the regression line on the scatter plot.
\begin{indication}
\begin{enumerate}
\item Select the menu \menu{Teaching > Charts > Scatter plot}.
\item In the dialog displayed, insert the variable \variable{Y} in the field \field{Y variable} and the
variable \variable{X} in the field \field{X variable}.
\item In the \menu{Fitted line} tab, check the box \option{Linear} and click the button
\button{Submit}.
\end{enumerate}
\end{indication}

\item Compute la regression line of $X$ on $Y$ and plot it on the scatter plot.
\begin{indication}
Repeat the steps of the previous part but inserting the variable \variable{X} in the field \field{Dependent variable}
and the variable \variable{Y} in the field \field{Independent variable(s)}. 
\end{indication}

\item How are the residuals?
Comment the results.
\end{enumerate}


\item A study pretends to determine the relation between the daily hours of study and the number of failed subjects in
a course. 
The values of these variables in a sample of 30 students were:
\[
\begin{array}{cccccccc}
\text{Study hours} & \text{Failed subjects} &  & \text{Study hours} & \text{Failed subjects} & & \text{Study hours} &
\text{Failed subjects}
\\
\cline{1-2}\cline{4-5}\cline{7-8}
3.5 & 1 & & 2.2 & 2 & & 1.3 & 4 \\
0.6 & 5 & & 3.3 & 0 & & 3.1 & 0 \\
2.8 & 1 & & 1.7 & 3 & & 2.3 & 2 \\
2.5 & 3 & & 1.1 & 3 & & 3.2 & 2 \\
2.6 & 1 & & 2.0 & 3 & & 0.9 & 4 \\
3.9 & 0 & & 3.5 & 0 & & 1.7 & 2 \\
1.5 & 3 & & 2.1 & 2 & & 0.2 & 5 \\
0.7 & 3 & & 1.8 & 2 & & 2.9 & 1 \\
3.6 & 1 & & 1.1 & 4 & & 1.0 & 3 \\
3.7 & 1 & & 0.7 & 4 & & 2.3 & 2 \\
\end{array}
\]

Do the following operations:
\begin{enumerate}
\item  Create a data set with the variables \variable{study.hours} and \variable{failed.subjects} and enter the data of
the sample.

\item Construct the two-dimensional frequency table of the variables \variable{study.hours} and
\variable{failed.subjects}.
\begin{indication}
\begin{enumerate}
\item Select the menu \menu{Teaching > Frequency distribution > Two-dimensional frequency table}.
\item In the dialog displayed insert the variable \variable{study.hours} in the field \field{Variable to 
tabulate in rows} and the variable \variable{failed.subjects} in the field \field{Variable to tabulate in columns}.
\item In the \mtab{Row classes} tab, check the box \field{Grouping intervals for the row variable}, and
click the button \button{Submit}. 
\end{enumerate}
\end{indication}

\item Compute la regression line of \variable{failed.subjects} on  \variable{study.hours} and plot it.
\begin{indication}
To compute the regression line:
\begin{enumerate}
\item Select the menu \menu{Teaching > Regression > Linear regression}.
\item In the dialog displayed insert the variable \variable{failed.subjects} in the field \field{Dependent variable} and
the variable \variable{study.hours} in the field \field{Independent variable(s)}, check the box \option{Save the model},
enter the name \variable{linear.model.failed.subjects.on.study.hours} for the regression model and click the button
\button{Submit}.
\end{enumerate}
To plot he regression line:
\begin{enumerate}
\item Select the menu \menu{Teaching > Charts > Scatter plot}.
\item In the dialog displayed insert the variable \variable{failed.subjects} in the field \field{Y variable} and the
variable \variable{study.hours} in the field \field{X variable}.
\item In the \mtab{Fitted line} tab, check the box \option{Linear} and click the button \button{Submit}.
\end{enumerate}
\end{indication}

\item What is the regression coefficient of the failed subjects on the daily hours of study?
Interpret it.
\begin{indication}
The regression coefficient is the slope of the regression line. 
\end{indication}

\item The linear relation is stronger or weaker than in the previous exercise? 
Answer the question comparing the residuals in both linear models.

\item Compute the linear coefficient of determination and the correlation coefficient.
Is the linear model a good model to explain the relation between the failed subjects and the daily hours of study?
What percentage of the variability of the failed subjects is explained by the linear model? 
\begin{indication}
The coefficient of determination is showed as \result{R$^2$} in output window, and the correlation coefficient is the
square root.
\end{indication}

\item Use the linear model to predict the expected number of failed subjects for a student that studies 3 hours a day. 
Is this prediction reliable?
\begin{indication}
\begin{enumerate}
\item Select the menu \menu{Teaching > Regression > Predictions}.
\item In the dialog displayed insert the model \variable{linear.model.failed.subjects.on.study.hours} in the field
\field{Regression model}, enter the value 3 in the in field \field{Predictions for} and click the button
\button{Submit}.
\end{enumerate}
\end{indication}

\item According to the linear model, how many hours of study are required at least to pass all the subjects?
\begin{indication}
To compute the regression line:
\begin{enumerate}
\item Select the menu \menu{Teaching > Regression > Linear regression}.
\item In the dialog displayed insert the variable \variable{study.hours} in the field \field{Dependent variable} and
the variable \variable{failed.subjects} in the field \field{Independent variable(s)}, check the box \option{Save the
model}, enter the name \variable{linear.model.study.hours.on.failed.subjects} for the regression model
and click the button \button{Submit}.
\end{enumerate}
To make the prediction:
\begin{enumerate}
\item Select the menu \menu{Teaching > Regression > Predictions}.
\item In the dialog displayed insert the model \variable{linear.model.study.hours.on.failed.subjects} in
the field \field{Regression model}, enter the value 0 in the in field \field{Predictions for} and click the button
\button{Submit}.
\end{enumerate}
\end{indication}
\end{enumerate}


\item To determine how an organism metabolizes the alcohol, an experiment was conducted where we measured the
alcohol in blood every half an hour after drinking a liter of wine.
The data of the experiment are below.
\[
\begin{array}{lrrrrrrr}
\hline 
\mbox{Time (min)} & 30 & 60 & 90 & 120 & 150 & 180 & 210\\ 
\mbox{Alcohol (gr/l)} & 1.6 & 1.7 & 1.5 & 1.1 & 0.7 & 0.2 & 2.1\\
\hline
\end{array}
\]

Do the following operations:
\begin{enumerate}
\item Create a data set with the variables \variable{time} and \variable{alcohol} and enter the data of the sample.
\item Compute the linear correlation coefficient of the alcohol and the time and interpret it.
Is the linear model a good model to explain the metabolization of alcohol?
\begin{indication}
\begin{enumerate}
\item Select the menu \menu{Teaching > Regression > Correlation}.
\item In the dialog displayed insert the variables \variable{alcohol} and \variable{time} in the field \field{Variables}, and click the button \button{Submit}.
\end{enumerate}
\end{indication}

\item Plot the regression line of alcohol on time. 
Are there some point with a big residual?
In such a case, remove the point from the sample and compute again the linear correlation coefficient. 
Has the model improved?
\begin{indication}
\begin{enumerate}
\item Select the menu \menu{Teaching > Charts > Scatter plot}.
\item In the dialog displayed insert the variable \variable{alcohol} in the field \field{Y variable}, the
variable \variable{time} in the field \field{X variable}.
\item In the \mtab{Fitted line} tab click the box \option{Linear} and click the button \button{Submit}.
\end{enumerate}
It is observed that the point $(210,2.1)$ has a huge residual compared to the others, what means that it's an outlier. 
To remove the outlier in the data edition windows, right-click the header row corresponding to the point and select
\option{Delete this row}.
\end{indication}

\item Use the regression line of alcohol on time to estimate the speed of alcohol metabolization. 
\begin{indication}
  \begin{enumerate}
  \item Select the menu \menu{Teaching > Regression > Linear regression}.
  \item In the dialog displayed insert the variable \variable{alcohol} in the field \field{Dependent variable}, the variable \variable{time} in the field \field{Independent variable(s)}, and click the button \button{Submit}.
  \item The speed of alcohol metabolization is the slope of the regression line.
  \end{enumerate}
\end{indication}


\item If, according to the law, the maximum concentration of alcohol in blood to drive is $0.3$ g/l, how much
time must wait this person to drive after drinking a litter of wine?
Is this prediction reliable?
\begin{indication}
To compute the regression line:
\begin{enumerate}
\item Select the menu \menu{Teaching > Regression > Linear regression}.
\item In the dialog displayed insert the variable \variable{time} in the field \field{Dependent variable} and the
variable \variable{alcohol} in the field \field{Independent variable(s)}.
\item Check the box \option{Save the model}, enter the name \variable{linear.model.time.on.alcohol} for the linear model
and click the button \button{Submit}.
\end{enumerate}
To make the prediction:
\begin{enumerate}
\item Select the menu \menu{Teaching > Regression > Predictions}.
\item In the dialog displayed insert the model \variable{linear.model.time.on.alcohol} in the field \field{Regression
model}, enter the value 0.3 in the field \field{Predictions for} and click the button \button{Submit}.
\end{enumerate}
\end{indication}
\end{enumerate}


\item The data set \variable{age.height} of the package \variable{rk.Teaching} contains the age and the height of 30
persons.
Do the following operations:
\begin{enumerate}
\item Load the data set \variable{age.height} from the package \variable{rk.Teaching}.

\item Compute la regression line of the height on the age.
Is the linear model a good model to explain the relation between the height and the age?
\begin{indication}
\begin{enumerate}
\item Select the menu \menu{Teaching > Regression > Linear regression}.
\item In the dialog displayed insert the variable \variable{height} in the field \field{Dependent variable}, the
variable \variable{age} in the field \field{Independent variable(s)}, and click the button \button{Submit}.
\end{enumerate}
\end{indication}

\item Create the scatter plot of the height on the age. 
Around which age changes the tendency?
\begin{indication}
\begin{enumerate}
\item Select the menu \menu{Teaching > Charts > Scatter plot}.
\item In the dialog displayed insert the variable \variable{height} in the field \field{Y variable},
the variable \variable{age} in the field \field{X variable} and click the button \button{Submit}.
\end{enumerate}
\end{indication}

\item Recode the variable age into the categorical variable \variable{age.group} with two categories for younger
and older than 20 years.
\begin{indication}
\begin{enumerate}
\item Select the menu \menu{Teaching >  Data > Variable recoding}.
\item In the dialog displayed insert the variable \variable{age} in the field \field{Variable to recode}.
\item In the field \field{Recoding rules} enter the following rules:
\begin{quote}
\lstinline{lo:20 = "younger"}\\
\lstinline{20:hi = "older"}
\end{quote}
\item In the field \field{Save new variable} click the button \button{Change}.
\item In the dialog displayed select as parent object the data set \variable{age.height} and click the button
\button{OK}.
\item Enter the name \variable{age.group} for the new variable and click the button \button{Submit}.
\end{enumerate}
\end{indication}

\item Compute the regression line of the height on the age for every age group.
In which group the linear model explains better the relation between the height and the age? 
Justify the answer.
\begin{indication}
\begin{enumerate}
\item Select the menu \menu{Teaching > Regression > Linear regression}.
\item In the dialog displayed insert the variable \variable{height} in the field \field{Dependent variable} and la
variable \variable{age} in the field \field{Independent variable(s)}.
\item Check the box \option{Regression by groups} and insert the variable \variable{age.group} in the field
\field{Grouping variable(s)}.
\item Check the box \option{Save the model}, enter the name \variable{linear.model.height.on.age} for the linear
model and click the button \button{Submit}.
\end{enumerate}
\end{indication}

\item Plot the regression lines of the previous part.
\begin{indication}
\begin{enumerate}
\item Select the menu \menu{Teaching > Charts > Scatter plot}.
\item In the dialog displayed insert the variable \variable{height} in the field \field{Y variable} and
the variable \variable{age} in the field \field{X variable}.
\item Check the box \option{Plot by groups} and insert the variable \variable{age.group} in the field
\field{Grouping variable(s)}.
\item In the \mtab{Fitted line} tab, check the box \option{Linear} and click the button \button{Submit}.
\end{enumerate}
\end{indication}

\item According to the linear model, what is the expected height for a 14 years old person? And for a 38 years old
person?
\begin{indication}
To predict the height of the 14 years old person:
\begin{enumerate}
\item Select the menu \menu{Teaching > Regression > Predictions}.
\item In the dialog displayed insert the model \variable{linear.regression.height.on.age.younger} in the field
\field{Regression model}, enter the value 14 in the field \field{Predictions for} and click the button \button{Submit}.
\end{enumerate}
To predict the height of the 38 years old person:
\begin{enumerate}
\item Select the menu \menu{Teaching > Regression > Predictions}.
\item In the dialog displayed insert the model \variable{linear.regression.height.on.age.older} in the field
\field{Regression model}, enter the value 38 in the field \field{Predictions for} and click the button \button{Submit}.
\end{enumerate}
\end{indication}
\end{enumerate}

% \opt{largo}{
% \item La siguiente tabla recoge la información de las calificaciones obtenidas por un grupo de alumnos en dos
% asignaturas $X$ e $Y$.
% \begin{center}
% \begin{tabular}{lcccccccccccc}
% Alumno & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12\\
% \hline
% $X$ & NT & AP & SS & SS & AP & AP & SS & NT & SB & SS & AP & AP\\
% $Y$ & SB & SS & AP & SS & AP & NT & SS & NT & NT & AP & AP & NT
% \end{tabular}
% \end{center}
% Do the following operations:
% \begin{enumerate}
% \item Create a data set con las variables \varaible{X} e \variable{Y} and enter the data.
% 
% \item ¿Existe relación entre las calificaciones de $X$ e $Y$? Justificar la respuesta.
% \begin{indication}
% \begin{enumerate}
% \item Select the menu \menu{Teaching > Regression > Correlación}.
% \item In the dialog displayed select the variables \variable{X} e \variable{Y} in the field
% \field{Variables}.
% \item En la solapa \menu{Opciones de correlación} seleccionar el método de \option{Ro de Spearman} and hacer clic sobre
% el botón \button{Submit}.
% \end{enumerate}
% \end{indication}
% \end{enumerate}
% }
\end{enumerate}


\section{Proposed exercises}
\begin{enumerate}[leftmargin=*]
\item A research study has been conducted to determine the loss of activity of a drug.
The table below shows the results of the experiment.

\begin{center}
\begin{tabular}{|l|r|r|r|r|r|}
\hline
Time (in years) & 1 & 2 & 3 & 4 & 5 \\ \hline
Activity (\%) & 96 & 84 & 70 & 58 & 52 \\ \hline
\end{tabular}
\end{center}
Do the following operations:
\begin{enumerate}
\item Compute the regression line of the drug activity on time.
\item What percentage decreases the drug activity every year?  
\item How much time must pass for the drug to have an activity of 80\%? When will be the activity null?
Are these predictions equally reliable?
\end{enumerate}

\item In an study about the effect of different doses of a medicament, 2 patients got 2 mg and took 5 days to cure, 4
patients got 2 mg and took 6 days to cure, 2 patients got 3 mg ant took 3 days to cure, 4 patients got 3 mg and took 5
days to cure, 1 patient got 3 mg and took 6 days to cure, 5 patients got 4 mg and took 3 days to cure and 2 patients got
4 mg and took 5 days to cure. 
Do the following operations:
\begin{enumerate}
\item Compute the regression line of the days to cure on the dose.
\item Compute the regression coefficient of the days to cure on the dose and interpret it.
\item Compute the correlation coefficient and interpret it.
\item Determine the expected time required to cure with a 5 mg dose.
Is this prediction reliable? Justify the answer.
\item What dose must be applied to last 4 days to cure? 
Is this prediction reliable? Justify the answer.
\end{enumerate}

\item The data set \variable{heights.weights.students} of the package \variable{rk.Teaching}, contains the height, the
weight and the gender of a sample of students.
Do the following operations:
\begin{enumerate}
\item Load the data set \variable{heights.weights.students} from the package \variable{rk.Teaching}.
\item Compute the regression line of weight on height and plot it.
\item Compute the regression lines of weight on height for males and females and plot them.
\item Compute the coefficients of determination for both models. 
Which model explains better the relation between weight and height, the males or the females one?
Justify the answer.
\item What is the expected weight for a man 170 cm tall? And for a women of the same height?
\end{enumerate}

\item The data set \variable{neonates} of the package \variable{rk.Teaching}, contains information about a
sample of 320 newborns that meet the normal gestation time in a hospital during one year.
Do the following operations:
\begin{enumerate}
\item Construct the two-dimensional frequency table of the APGAR score at 1 minute and whether the mother smoked or not
during the pregnancy.
What conclusions can you draw?
\item Construct the two-dimensional frequency table of te weight and the age of the mother.
What conclusions can you draw?
\item Compute the regression line of the weight on the daily number of cigarettes smoked by the mother during the
pregnancy.
Is there a strong linear relation between the variables?
\item Plot the regression line of the previous part. 
Why the regression line doesn't fit well the point cloud?
\item Compute the regression line of the weight on the daily cigarettes smoked by the mother during the
pregnancy in the group of smoking mothers.
Is this regression model better or worse than the previous one?
According to this model, how much decreases the weight of newborns for every daily cigarette smoked by the mother?
\item According to the previous linear model, what will be the expected weight of a nenonate with a mother that
smokes 5 daily cigarettes during the pregnancy?
And for a mother that smokes 30 daily cigarettes?
Are these predictions reliable?
\item Are there the same linear relation between the weight and the daily cigarettes somoked by the mother for mothers
younger than 20 years and mothers older than 20 years?
What conclusions can you draw?
\end{enumerate}
\end{enumerate}